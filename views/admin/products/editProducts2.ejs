<section class="content-main">
    <div class="row">
        <div class="col-9">
            <div class="content-header">
                <h2 class="content-title">Edit Product - <%= product.product_name %></h2>
            </div>
        </div>
    </div>
    <form action="/admin/edit-product/<%= product._id %>" method="post" enctype="multipart/form-data">
        <div class="row">
            <div class="col-lg-12">
                <div class="card mb-4">
                    <div class="card-body">
                        <div class="mb-4">
                            <label for="product_name" class="form-label">Product Name</label>
                            <input type="text" value="<%= product.product_name %>" placeholder="Type here" class="form-control" name="productName" id="product_name" required>
                        </div>
                        <div class="mb-4">
                            <label for="status" class="form-label">Status</label>
                            <select class="form-select" name="status" aria-label="List or Unlist">
                                <% if (!product.isDeleted) { %>
                                    <option value="false">Listed</option>
                                    <option value="true">Unlisted</option>
                                <% } else { %>
                                    <option value="true">Unlisted</option>
                                    <option value="false">Listed</option>
                                <% } %>
                            </select>
                        </div>
                        <div class="mb-4">
                            <label for="category_name" class="form-label">Categories</label>
                            <select name="categoryName" id="categoryName" class="form-select">
                                <option value="<%= product.category._id %>"><%= product.category.name %></option>
                                <% categories.forEach(category => { %>
                                    <% if (category.name !== product.category.name) { %>
                                        <option value="<%= category._id %>">
                                            <%= category.name %>
                                        </option>
                                    <% } %>
                                <% }) %>
                            </select>
                        </div>
                        <div class="mb-4">
                            <label class="form-label">Full description</label>
                            <textarea placeholder="Type here" class="form-control" name="productDespt" rows="4" required><%= product.description %></textarea>
                        </div>
                        <div class="row">
                            <div class="col-lg-4">
                                <div class="mb-4">
                                    <label class="form-label">Regular price</label>
                                    <div class="row gx-2">
                                        <input placeholder="regular_price" value="<%= product.price %>" name="price" type="number" class="form-control" required>
                                        <small></small>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-4">
                                <div class="mb-4">
                                    <label class="form-label">Stock</label>
                                    <div class="row gx-2">
                                        <input placeholder="Stock" name="productStock" value="<%= product.stock %>" type="number" class="form-control" required>
                                        <small></small>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-4">
                
                                <div class="card mb-4">
                                    <div class="card-header">
                                        <h4>Primary image</h4>
                                    </div>
                                    <div class="card-body">
                                        <div class="input-upload">
                                            <img id="primaryImagePreview" src="/uploads/products-images/crp/<%- product.primaryImages[0] ? product.primaryImages[0].name : product.secondaryImages[0].name %>" alt="">
                                            <input class="form-control" name="primaryImage" type="file" id="primaryImageInput" >
                                        </div>
                                    </div>
                    
                                </div>
                            </div>  
                        </div>
                        <div class="row">
                            <% if (product.secondaryImages[0]) { %>
                                <div class="col-4">
                                    <div class="card mb-4">
                                        <div class="card-header">
                                            <h4>Secondary Image 1</h4>
                                        </div>
                                        <div class="card-body">
                                            <div class="input-upload">
                                            <img id="secondaryImage1Preview" src="/uploads/products-images/crp/<%-product.secondaryImages[0].name %>" alt="">
                                            <input class="form-control" name="secondaryImage1" type="file" id="secondaryImage1Input">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            <% } %>
                            <% if (product.secondaryImages[1]) { %>
                                <div class="col-4">
                                    <div class="card mb-4">
                                        <div class="card-header">
                                            <h4>Secondary Image 2</h4>
                                        </div>
                                        <div class="card-body">
                                            <div class="input-upload">
                                            <img id="secondaryImage2Preview" src="/uploads/products-images/crp/<%-product.secondaryImages[1].name %>" alt="">
                                            <input class="form-control" name="secondaryImage2" type="file" id="secondaryImage2Input">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            <% } %>
                            <% if (product.secondaryImages[2]) { %>
                                <div class="col-4">
                                    <div class="card mb-4">
                                        <div class="card-header">
                                            <h4>Secondary Image 3</h4>
                                        </div>
                                        <div class="card-body">
                                            <div class="input-upload">
                                            <img id="secondaryImage3Preview" src="/uploads/products-images/crp/<%-product.secondaryImages[2].name %>" alt="">
                                            <input class="form-control" name="secondaryImage3" type="file" id="secondaryImage3Input" >
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            <% } %>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col">
                <button class="btn btn-md rounded font-sm" type="submit">Update</button>
                <a href="/admin/product" class="btn btn-light rounded font-sm">Cancel</a>
            </div>
        </div>
    </form>
</section>

<script>
    // Example for primary image
    const primaryImageInput = document.getElementById('primaryImageInput');
    const primaryImagePreview = document.getElementById('primaryImagePreview');
    let primaryCropper;

    primaryImageInput.addEventListener('change', (e) => {
        const files = e.target.files;
        if (files && files.length > 0) {
            const file = files[0];
            const url = URL.createObjectURL(file);
            primaryImagePreview.src = url;

            if (primaryCropper) {
                primaryCropper.destroy();
            }

            primaryCropper = new Cropper(primaryImagePreview, {
                aspectRatio: 1,
                viewMode: 1,
                crop(event) {
                    // Handle cropping event
                },
            });
        }
    });

    // Similar code for secondary images
    const secondaryImage1Input = document.getElementById('secondaryImage1Input');
    const secondaryImage1Preview = document.getElementById('secondaryImage1Preview');
    let secondaryCropper1;

    secondaryImage1Input.addEventListener('change', (e) => {
        const files = e.target.files;
        if (files && files.length > 0) {
            const file = files[0];
            const url = URL.createObjectURL(file);
            secondaryImage1Preview.src = url;

            if (secondaryCropper1) {
                secondaryCropper1.destroy();
            }

            secondaryCropper1 = new Cropper(secondaryImage1Preview, {
                aspectRatio: 1,
                viewMode: 1,
                crop(event) {
                    // Handle cropping event
                },
            });
        }
    });

    const secondaryImage2Input = document.getElementById('secondaryImage2Input');
    const secondaryImage2Preview = document.getElementById('secondaryImage2Preview');
    let secondaryCropper2;

    secondaryImage2Input.addEventListener('change', (e) => {
        const files = e.target.files;
        if (files && files.length > 0) {
            const file = files[0];
            const url = URL.createObjectURL(file);
            secondaryImage2Preview.src = url;

            if (secondaryCropper2) {
                secondaryCropper2.destroy();
            }

            secondaryCropper2 = new Cropper(secondaryImage2Preview, {
                aspectRatio: 1,
                viewMode: 1,
                crop(event) {
                    // Handle cropping event
                },
            });
        }
    });

    const secondaryImage3Input = document.getElementById('secondaryImage3Input');
    const secondaryImage3Preview = document.getElementById('secondaryImage3Preview');
    let secondaryCropper3;

    secondaryImage3Input.addEventListener('change', (e) => {
        const files = e.target.files;
        if (files && files.length > 0) {
            const file = files[0];
            const url = URL.createObjectURL(file);
            secondaryImage3Preview.src = url;

            if (secondaryCropper3) {
                secondaryCropper3.destroy();
            }

            secondaryCropper3 = new Cropper(secondaryImage3Preview, {
                aspectRatio: 1,
                viewMode: 1,
                crop(event) {
                    // Handle cropping event
                },
            });
        }
    });
</script>