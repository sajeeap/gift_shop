<!-- Product -->
<div class="bg0 m-t-23 p-b-140">
	<div class="container">
		<div class="flex-w flex-sb-m p-b-52">

			<div class="flex-w flex-l-m filter-tope-group m-tb-10">
				<button class="stext-106 cl6 hov1 bor3 trans-04 m-r-32 m-tb-5 how-active1" data-filter="*">
					All Products
				</button>
			</div>
			<div class="flex-w flex-c-m m-tb-10 ">


				<div class="flex-c-m stext-106 cl6 size-104 bor4 pointer hov-btn3 trans-04 m-r-8 m-tb-4 js-show-filter">
					<i class="icon-filter cl2 m-r-6 fs-15 trans-04 zmdi zmdi-filter-list"></i>
					<i class="icon-close-filter cl2 m-r-6 fs-15 trans-04 zmdi zmdi-close dis-none"></i>
					Filter
				</div>
				<div class="flex-c-m stext-106 cl6 size-105 bor4 pointer hov-btn3 trans-04 m-tb-4 js-show-search">
					<i class="icon-search cl2 m-r-6 fs-15 trans-04 zmdi zmdi-search"></i>
					<i class="icon-close-search cl2 m-r-6 fs-15 trans-04 zmdi zmdi-close dis-none"></i>
					Search
				</div>
			</div>

			<!-- Search product -->
			<div class="dis-none panel-search w-full p-t-10 p-b-15">
				<div class="bor8 dis-flex p-l-15">
					<button class="size-113 flex-c-m fs-16 cl2 hov-cl1 trans-04">
						<i class="zmdi zmdi-search"></i>
					</button>

					<input class="mtext-107 cl2 size-114 plh2 p-r-15" type="text" name="search-product"
						placeholder="Search">
				</div>
			</div>

			<!-- Filter -->
			<div class="dis-none panel-filter w-full p-t-10">
				<div class="wrap-filter flex-w bg6 w-full p-lr-40 p-t-27 p-lr-15-sm">
					<div class="filter-col1 p-r-15 p-b-27  filter-tope-group">
						<div class="mtext-102 cl2 p-b-15">
							Categories
						</div>
						<div class="flex-w flex-wrap">
							<!-- Category buttons -->
							<% categories.forEach(category=> { %>
								<div class="m-r-15 m-b-10">
									<button class="stext-106 cl6 hov1 bor3 trans-04 category-button"
										data-filter=".<%- category.name %>">
										<%- category.name.charAt(0).toUpperCase() + category.name.slice(1) %>
									</button>
								</div>

								<% }) %>
						</div>
					</div>


					<!-- Sort By -->
					<div class="filter-col1 p-r-15 p-b-27">
						<div class="mtext-102 cl2 p-b-15">
							Sort By
						</div>

						<ul>
							<li class="p-b-6">
								<a href="?sort=createdAt&order=-1"
									class="filter-link stext-106 trans-04 <%= currentSort === 'createdAt' && currentOrder === '-1' ? 'filter-link-active' : '' %>">
									Newness
								</a>
							</li>
							<li class="p-b-6">
								<a href="?sort=popularity&order=-1"
									class="filter-link stext-106 trans-04 <%= currentSort === 'popularity' && currentOrder === '-1' ? 'filter-link-active' : '' %>">
									Popularity
								</a>
							</li>
							<li class="p-b-6">
								<a href="?sort=average_rating&order=-1"
									class="filter-link stext-106 trans-04 <%= currentSort === 'average_rating' && currentOrder === '-1' ? 'filter-link-active' : '' %>">
									Average Rating
								</a>
							</li>
							<li class="p-b-6">
								<a href="?sort=price&order=1"
									class="filter-link stext-106 trans-04 <%= currentSort === 'price' && currentOrder === '1' ? 'filter-link-active' : '' %>">
									Price: Low to High
								</a>
							</li>
							<li class="p-b-6">
								<a href="?sort=price&order=-1"
									class="filter-link stext-106 trans-04 <%= currentSort === 'price' && currentOrder === '-1' ? 'filter-link-active' : '' %>">
									Price: High to Low
								</a>
							</li>
							<li class="p-b-6">
								<a href="?sort=product_name&order=1"
									class="filter-link stext-106 trans-04 <%= currentSort === 'product_name' && currentOrder === '1' ? 'filter-link-active' : '' %>">
									A-Z
								</a>
							</li>
							<li class="p-b-6">
								<a href="?sort=product_name&order=-1"
									class="filter-link stext-106 trans-04 <%= currentSort === 'product_name' && currentOrder === '-1' ? 'filter-link-active' : '' %>">
									Z-A
								</a>
							</li>
						</ul>
					</div>


					<div class="filter-col2 p-r-15 p-b-27">
						<div class="mtext-102 cl2 p-b-15">
							Price
						</div>

						<ul>
							<li class="p-b-6">
								<a href="#" class="filter-link stext-106 trans-04 filter-link-active">
									All
								</a>
							</li>

							<li class="p-b-6">
								<a href="#" class="filter-link stext-106 trans-04">
									$0.00 - $50.00
								</a>
							</li>

							<li class="p-b-6">
								<a href="#" class="filter-link stext-106 trans-04">
									$50.00 - $100.00
								</a>
							</li>

							<li class="p-b-6">
								<a href="#" class="filter-link stext-106 trans-04">
									$100.00 - $150.00
								</a>
							</li>

							<li class="p-b-6">
								<a href="#" class="filter-link stext-106 trans-04">
									$150.00 - $200.00
								</a>
							</li>

							<li class="p-b-6">
								<a href="#" class="filter-link stext-106 trans-04">
									$200.00+
								</a>
							</li>
						</ul>
					</div>




				</div>
			</div>


		</div>

		<div class="row isotope-grid">
			<% products.forEach(product=> { %>
				<% if (!product.isDeleted) { %>
					<div class="col-sm-6 col-md-4 col-lg-3 p-b-35 isotope-item <%- product.category.name %>">
						<!-- Block2 -->
						<div class="block2">
							<div class="block2-pic hov-img0">
								<a href="/product-details/<%- product._id %>">
									<img src="/uploads/products-images/crp/<%- product?.primaryImages[0].name %>"
										alt="IMG-PRODUCT">
								</a>
							</div>

							<div class="block2-txt flex-w flex-t p-t-14">
								<div class="block2-txt-child1 flex-col-l ">
									<a href="/product-details/<%- product._id %>"
										class="stext-104 cl4 hov-cl1 trans-04 js-name-b2 p-b-6">
										<%= product.product_name.charAt(0).toUpperCase() + product.product_name.slice(1)
											%>
									</a>

									<a href="/dummy">

										<span class="stext-105 cl3">
											$<%= product.price %>.00
										</span>

									</a>


								</div>

								<div class="block2-txt-child2 flex-r p-t-3">
									<a href="#" class="btn-addwish-b2 dis-block pos-relative   add-to-wishlist"
										data-product-id="<%= product._id %>">
										<img class="icon-heart1 dis-block trans-04" src="images/icons/icon-heart-01.png"
											alt="ICON">
										<img class="icon-heart2 dis-block trans-04 ab-t-l"
											src="images/icons/icon-heart-02.png" alt="ICON">
									</a>
								</div>
							</div>
						</div>
					</div>
					<% } %>
						<% }) %>
		</div>

	</div>




	
</div>


<script>
	document.querySelectorAll('.btn-addwish-b2').forEach(icon => {
		icon.addEventListener('click', function () {
			const productId = this.getAttribute('data-product-id');
			addToWishlist(productId);
		});
	});

	function addToWishlist(productId) {
		fetch('/user/add-to-wishlist', {
			method: 'POST',
			headers: {
				'Content-Type': 'application/json',
			},
			body: JSON.stringify({ productId }),
		})
			.then(response => response.json())
			.then(data => {
				if (data.success) {
					Swal.fire({
						icon: 'success',
						title: 'Added to Wishlist',
						text: 'Product added to your wishlist successfully!',
					});
				} else {
					Swal.fire({
						icon: 'error',
						title: 'Error',
						text: 'Failed to add product to wishlist: ' + data.message,
					});
				}
			})
			.catch(error => {
				console.error('Error:', error);
				Swal.fire({
					icon: 'error',
					title: 'Server Error',
					text: 'An error occurred while adding product to wishlist',
				});
			});
	}
</script>